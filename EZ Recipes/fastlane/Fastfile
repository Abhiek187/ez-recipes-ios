# This file contains the fastlane.tools configuration
# You can find the documentation at https://docs.fastlane.tools
#
# For a list of all available actions, check out
#
#     https://docs.fastlane.tools/actions
#
# For a list of all available plugins, check out
#
#     https://docs.fastlane.tools/plugins/available-plugins
#

# Uncomment the line if you want fastlane to automatically update itself
# update_fastlane

default_platform(:ios)

platform :ios do
  desc "Run tests on multiple devices"
  lane :tests do
    # Add actions here: https://docs.fastlane.tools/actions
    # Resolve package dependencies: xcodebuild -resolvePackageDependencies -scheme EZ\ Recipes -project ./EZ\ Recipes.xcodeproj
    # Show build settings: xcodebuild -showBuildSettings -scheme EZ\ Recipes -project ./EZ\ Recipes.xcodeproj
    # Disable 'Slide to Type' on each simulator: /usr/libexec/PlistBuddy -c "Add :KeyboardContinuousPathEnabled bool false" /Users/runner/Library/Developer/CoreSimulator/Devices/84CA0B87-356F-4160-A3E7-5AC636BEF880/data/Library/Preferences/com.apple.keyboard.ContinuousPath.plist >/dev/null 2>&1
    # Build project & run unit and UI tests on all simulators: set -o pipefail && env NSUnbufferedIO=YES xcodebuild -scheme EZ\ Recipes -project ./EZ\ Recipes.xcodeproj -derivedDataPath /Users/runner/Library/Developer/Xcode/DerivedData/EZ_Recipes-ezjdpeyqgdqzmkavgpppqphrlryh -destination 'platform=iOS Simulator,id=84CA0B87-356F-4160-A3E7-5AC636BEF880' -destination 'platform=iOS Simulator,id=330814AD-9DF3-48FA-91EF-F3E328FCE01F' -destination 'platform=iOS Simulator,id=1691A7E5-13F6-4969-8986-D32AFCF956A9' build test | tee '/Users/runner/Library/Logs/scan/EZ Recipes-EZ Recipes.log' | xcpretty  --report html --output '/Users/runner/work/ez-recipes-ios/ez-recipes-ios/EZ Recipes/fastlane/test_output/report.html' --report junit --output '/Users/runner/work/ez-recipes-ios/ez-recipes-ios/EZ Recipes/fastlane/test_output/report.junit' --report junit --output '/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/junit_report20221031-2046-kcoou8'
    run_tests(scheme: "EZ Recipes",
              devices: ["iPhone 8", "iPhone 14 Pro Max", "iPad Pro (9.7-inch)"])
  end
  
  desc "Upload a new build to the App Store"
  lane :release do
    capture_screenshots                  # generate new screenshots for the App Store
    sync_code_signing(type: "appstore")  # see code signing guide for more information
    build_app(scheme: "EZ Recipes")
    upload_to_app_store                  # upload your app to App Store Connect
  end
end
